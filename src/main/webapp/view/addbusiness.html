<!DOCTYPE html>
<!--suppress ALL-->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>添加商机</title>
    <link rel="stylesheet" href="/layui/css/layui.css" media="all">
    <script src="/js/jquery-1.12.3.min.js"></script>
    <script src="/layui/layui.js"></script>
</head>
<body>
<form class="layui-form layui-form-pane" id="for" action="/business/business.do" method="post">
    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label"><font color="red">*</font>商机名称</label>
            <div class="layui-input-inline" style="width:400px;">
                <input name="busname" id="busname" class="layui-input" type="text" style="width:400px;"
                       placeholder="请输入姓名"
                       readonly required lay-verify="busname" autocomplete="off">
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item" pane="">
            <label class="layui-form-label">优先级</label>
            <div class="layui-input-block">
                <input name="priority" title="高" type="radio" checked="" value="1">
                <input name="priority" title="中" type="radio" value="2">
                <input name="priority" title="低" type="radio" value="3">
            </div>
        </div>
    </div>

    <div class="layui-inline" style="margin-left: 140px;">
        <div class="layui-form-item">
            <div class="layui-inline">
                <a href="javascript:window.opener=null;window.open('','_self');window.close();" style="color: black"
                   class="layui-btn layui-icon layui-icon-return"><font color="black">返回</font></a>
                <a href="javascript:;" id="res" style="color: black"
                   class="layui-btn layui-icon layui-icon-refresh"><font color="black">刷新</font></a>
            </div>
        </div>
    </div>

    <div class="layui-form-item"
         style="border:1px solid ;background-color: #44aff0;height:35px;font-size: 20px;border-left: none;border-right: none;">
        客户信息
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label"><font color="red">*</font>客户名称</label>
            <div class="layui-input-inline" style="width:400px;">
                <select name="clientid" lay-filter="se" id="clilist" style="width:400px;">
                </select>
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label">所属行业</label>
            <div class="layui-input-inline" style="width:400px;">
                <input id="hangye" class="layui-input" readonly type="text" style="width:400px;" autocomplete="off">
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label">所在城市</label>
            <div class="layui-input-inline" style="width:400px;">
                <input id="chengshi" class="layui-input" readonly type="text" style="width:400px;" autocomplete="off">
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label">详细地址</label>
            <div class="layui-input-inline" style="width:400px;">
                <input id="dizhi" class="layui-input" readonly type="text" style="width:400px;" autocomplete="off">
            </div>
        </div>
    </div>

    <div class="layui-form-item"
         style="border:1px solid ;background-color: #44aff0;height:35px;font-size: 20px;border-left: none;border-right: none;">
        商机信息
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label"><font color="red">*</font>商机名称</label>
            <div class="layui-input-inline" style="width:400px;">
                <input name="shortname" onblur="myblur(this.value)" class="layui-input" type="text" style="width:400px;"
                       required autocomplete="off"/>
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label"><font color="red">*</font>商机来源</label>
            <div class="layui-input-inline" style="width:400px;">
                <select name="busfrom" required style="width:400px;">
                    <option value="0">请选择</option>
                    <option value="老客户">老客户</option>
                    <option value="代理商">代理商</option>
                    <option value="互联网">互联网</option>
                    <option value="独立开发">独立开发</option>
                    <option value="客户介绍">客户介绍</option>
                    <option value="合作伙伴">合作伙伴</option>
                    <option value="促销活动">促销活动</option>
                    <option value="媒体宣传">媒体宣传</option>
                    <option value="电话访问">电话访问</option>
                    <option value="客户来电">客户来电</option>
                    <option value="二次销售">二次销售</option>
                    <option value="公开招标">公开招标</option>
                    <option value="研讨会和展会">研讨会和展会</option>
                    <option value="其他">其他</option>
                </select>
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label" style="width: 150px;"><font color="red">*</font>预计成交金额</label>
            <div class="layui-input-inline" style="width:360px;">
                <input name="maymoney" class="layui-input" type="text" style="width:360px;"
                       required lay-verify="maymoney" autocomplete="off">
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label" style="width: 150px;">预计结单日期</label>
            <div class="layui-input-inline">
                <input name="maydate" id="date" class="layui-input" type="text" style="width:360px;"
                       required lay-verify="maydate" placeholder="yyyy-MM-dd" autocomplete="off">
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label"><font color="red">*</font>联系人</label>
            <div class="layui-input-inline" style="width:400px;">
                <input name="busperson" class="layui-input" type="text" style="width:400px;"
                       required autocomplete="off" lay-verify="busperson">
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label"><font color="red">*</font>联系人部门</label>
            <div class="layui-input-inline" style="width:400px;">
                <select name="perdept" required style="width:400px;">
                    <option value="0">请选择</option>
                    <option value="销售部">销售部</option>
                    <option value="售后部">售后部</option>
                    <option value="财务部">财务部</option>
                    <option value="人事部">人事部</option>
                </select>
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label">职务</label>
            <div class="layui-input-inline" style="width:400px;">
                <input name="buspostion" class="layui-input" type="text" style="width:400px;" autocomplete="off">
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label">固定电话</label>
            <div class="layui-input-inline" style="width:400px;">
                <input name="busofficenum" class="layui-input" type="text" style="width:400px;" autocomplete="off">
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label">移动电话</label>
            <div class="layui-input-inline" style="width:400px;">
                <input name="busnum" class="layui-input" type="text" style="width:400px;" autocomplete="off">
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label">邮件/QQ</label>
            <div class="layui-input-inline" style="width:400px;">
                <input name="busqq" class="layui-input" type="text" style="width:400px;" autocomplete="off">
            </div>
        </div>
    </div>

    <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">主要业务需求</label>
        <div class="layui-input-block">
            <textarea name="busneed" class="layui-textarea" placeholder="请输入内容"></textarea>
        </div>
    </div>


    <div class="layui-form-item">
        <label class="layui-form-label">相关附件</label>
        <div class="layui-input-block">
            <input name="busfile" class="layui-input" type="text" autocomplete="off">
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label" style="width: 150px;"><font color="red">*</font>商机所属部门</label>
            <div class="layui-input-inline" style="width:400px;">
                <input name="busdept" class="layui-input" type="text" style="width:400px;"
                       required lay-verify="busdept" autocomplete="off">
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label"><font color="red">*</font>商机负责人</label>
            <div class="layui-input-inline" style="width:400px;">
                <input name="busprincipal" class="layui-input" type="text" style="width:400px;"
                       required lay-verify="busprincipal" autocomplete="off">
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label">商机参与人</label>
            <div class="layui-input-inline" style="width:400px;">
                <input name="busparticipant" class="layui-input" type="text" style="width:400px;" autocomplete="off">
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <label class="layui-form-label">商机关注人</label>
            <div class="layui-input-inline" style="width:400px;">
                <input name="busfocus" class="layui-input" type="text" style="width:400px;" autocomplete="off">
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <div class="layui-input-block" style="width: 170px;">
                <button class="layui-btn layui-btn-normal layui-btn-radius" style="width: 170px;" lay-submit
                        lay-filter="sub">确定
                </button>
            </div>
        </div>
    </div>


    <div class="layui-inline">
        <div class="layui-form-item">
            <div class="layui-input-block" style="width: 170px;">
                <button class="layui-btn layui-btn-normal layui-btn-radius" style="width: 170px;">提交审核</button>
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <div class="layui-input-block" style="width: 170px;">
                <button class="layui-btn layui-btn-normal layui-btn-radius" style="width: 170px;">登记完成转跟单</button>
            </div>
        </div>
    </div>

    <div class="layui-inline">
        <div class="layui-form-item">
            <div class="layui-input-block" style="width: 170px;">
                <a href="javascript:window.opener=null;window.open('','_self');window.close();"
                   style="width: 200px;color: black" class="layui-btn layui-btn-primary layui-btn-radius">返回</font></a>
            </div>
        </div>
    </div>

</form>

<script>
    //失去焦点拼接名称
    var myblur = function (valu) {
        if (valu == "") {
            $("#busname").val("");
        } else {
            var shortname = $("#clilist").find('option:selected').text();
            var allname = shortname + "-" + valu;
            $("#busname").val(allname);
        }

    }

    $("#res").click(function () {
        document.getElementById("for").reset();
    });


    var listt = "";
    layui.use(['form', 'jquery', 'layer', 'laydate', 'upload'], function () {
        var form = layui.form;
        var $ = layui.jquery;
        var layer = layui.layer;
        var laydate = layui.laydate;
        var upload = layui.upload;

        /*        var uploadInst = upload.render({
                    elem: '#test1' //绑定元素
                    ,url: '/fileupload.do'
                    ,done: function(res){
                        $("#fileup").val(res.msg);
                        $('#demo3').attr('src', "/"+res.msg);
                        layer.alert('上传成功', {icon: 1});
                    }
                    ,error: function(){
                        layer.msg('系统繁忙，稍微等一下下欧', {icon: 5});
                    }
                });*/

        //日期
        laydate.render({
            elem: '#date'
        });
        //下拉框改变事件监听
        form.on('select(se)', function (data) {
            if (data.value == 0) {
                $("#hangye").val("");
                $("#chengshi").val("");
                $("#dizhi").val("");
                $("#cid").val(0);
            } else {
                $("#cid").val(data.value);
                for (var j = 0; j < listt.length; j++) {
                    if (listt[j].cliid == data.value) {
                        $("#hangye").val(listt[j].cliindustry);
                        $("#chengshi").val(listt[j].clicity);
                        $("#dizhi").val(listt[j].cliaddress);
                    }
                }
            }

        });
        //table
        form.on('submit(sub)', function (data) {
            var bus = data.field;
            $.ajax({
                type: "POST"
                , url: '/business/business.do'
                , data: bus
                , success: function (res) {
                    if (res == true) {
                        layer.msg("添加成功", {icon: 1});
                        window.close(document);
                    } else {
                        layer.msg("添加失败，请重新添加", {icon: 1});
                        window.close(document);
                    }
                }
            });
            return false;
        });

        form.verify({
            busfrom: function (value, item) {
                if (value == 0) {
                    return '请选择商机来源';
                }
            },
            perdept: function (value, item) {
                if (value == 0) {
                    return '请选择联系人部门';
                }
            },
            busname: function (value, item) { //value：表单的值、item：表单的DOM对象
                if (/(^\_)|(\__)|(\_+$)/.test(value)) {
                    return '商机名称首尾不能出现下划线\'_\'';
                }
                if (/^\d+\d+\d$/.test(value)) {
                    return '商机名称不能全为数字';
                }
                if (!/^[^ ]+$/.test(value)) {
                    return '商机名称不能包含空格';
                }
            }, busperson: [
                /^[\S]{2,8}$/
                , '请输入正确的联系人'
            ], busprincipal: [
                /^[\S]{2,8}$/
                , '请输入正确的商机负责人名称'
            ]
            , busdept: [
                /^[\S]{2,15}$/
                , '请输入正确的商机所属部门'
            ], maymoney: [
                /\d+/g
                , '请输入正确的金额格式'
            ], maydate: [
                /^\d{4}[-]\d{2}[-]\d{2}$/
                , '请输入正确的日期格式'
            ]
        });

        $(function () {
            $.get("/business/getCliByUid.do", function (data) {
                if (null != data) {
                    listt = data;
                    var str = "<option value='0'>请选择</option>";
                    for (var i = 0; i < listt.length; i++) {
                        str += "<option value='" + listt[i].cliid + "' >" + listt[i].cliname + "</option>"
                    }
                    $("#clilist").html(str);
                    form.render();//重载即渲染值进去
                }//当前用户没有客户 就不能进来这个页面！

            });
        });
    });
</script>
</body>
</html>